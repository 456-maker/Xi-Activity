<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é­”æ³•å…ƒç´ é›†é»</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.5; text-align:center; }
  h1 { color: #333; }
  p { margin: 10px 0; }
  button { padding: 12px 20px; font-size: 16px; margin-top: 20px; cursor: pointer; background-color: #ff9800; border: none; border-radius: 5px; color: #fff; }
  button:hover { background-color: #e68900; }
  button:disabled { background-color: #ccc; cursor: not-allowed; }
  #message { margin-top: 20px; font-weight: bold; color: #007bff; white-space: pre-wrap; }
</style>
</head>
<body>

<h1 id="taskTitle">é­”æ³•å…ƒç´ ä»»å‹™</h1>
<p id="taskDesc">ä»»å‹™èªªæ˜æ–‡å­—</p>
<button id="claimPoint">é ˜å–é»æ•¸1</button>
<div id="message"></div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw7E-dJkClxmgU9EN9DqFBzhdRdk6KAqAQTB1bMpXcUva9G8LOnDPPEOhyn-1VQBfxW/exec"; // æ”¹æˆä½ çš„ Web App URL

// æ¯å€‹ç«™é»å°æ‡‰çš„é­”æ³•å…ƒç´ å…§å®¹
const tasks = {
  "01": { title: "ç¬¬ä¸€ç«™ğŸŸ  æ©˜è‰²ï½œæ´»åŠ›èƒ½é‡", desc: "æ­å–œä½ ç²å¾—äº†ã€æ´»åŠ›èƒ½é‡ã€‘..." },
  "02": { title: "ç¬¬äºŒç«™âš« é»‘è‰²ï½œç¯€èƒ½ä¹‹åŠ›", desc: "æ­å–œä½ ç²å¾—äº†ã€ç¯€èƒ½ä¹‹åŠ›ã€‘..." },
  "03": { title: "ç¬¬ä¸‰ç«™ğŸŸ¢ ç¶ è‰²ï½œæ£®æ—å®ˆè­·", desc: "æ­å–œä½ ç²å¾—äº†ã€æ£®æ—å®ˆè­·ã€‘..." },
  "04": { title: "ç¬¬å››ç«™ğŸ”µ æ·ºè—è‰²ï½œæ¸…æ³‰ç¥ç¦", desc: "æ­å–œä½ ç²å¾—äº†ã€æ¸…æ³‰ç¥ç¦ã€‘..." },
  "05": { title: "ç¬¬äº”ç«™ğŸŸ£ ç´«è‰²ï½œæ™ºæ…§é­”æ³•", desc: "æ­å–œä½ ç²å¾—äº†ã€æ™ºæ…§é­”æ³•ã€‘..." },
  "06": { title: "ç¬¬å…­ç«™ğŸŸ¤ æ£•è‰²ï½œå¤§åœ°ä¹‹æ ¹", desc: "æ­å–œä½ ç²å¾—äº†ã€å¤§åœ°ä¹‹æ ¹ã€‘..." },
  "07": { title: "ç¬¬ä¸ƒç«™ğŸ”µ æ·±è—è‰²ï½œæµ·æ´‹ä¹‹åŠ›", desc: "æ­å–œä½ ç²å¾—äº†ã€æµ·æ´‹ä¹‹åŠ›ã€‘..." },
  "08": { title: "ç¬¬å…«ç«™ğŸ”´ ç´…è‰²ï½œæº«æš–ä¹‹å¿ƒ", desc: "æ­å–œä½ ç²å¾—äº†ã€æº«æš–ä¹‹å¿ƒã€‘..." },
  "09": { title: "ç¬¬ä¹ç«™ğŸŸ¡ é»ƒè‰²ï½œé™½å…‰é­”æ³•", desc: "æ­å–œä½ ç²å¾—äº†ã€é™½å…‰é­”æ³•ã€‘..." }
};

// å–å¾— URL åƒæ•¸
const urlParams = new URLSearchParams(window.location.search);
const station = urlParams.get('station'); // e.g., 01~09

const btn = document.getElementById("claimPoint");
const message = document.getElementById("message");

// æª¢æŸ¥ç«™é»æ˜¯å¦å­˜åœ¨
if (tasks[station]) {
  document.getElementById("taskTitle").innerText = tasks[station].title;
  document.getElementById("taskDesc").innerText = tasks[station].desc;
} else {
  document.getElementById("taskTitle").innerText = "æ„Ÿæ‡‰éŒ¯èª¤";
  document.getElementById("taskDesc").innerText = "è«‹ç¢ºèªæƒæçš„ NFC æ˜¯å¦æ­£ç¢ºã€‚";
  btn.style.display = "none";
  btn.disabled = true;
}

// LIFF åˆå§‹åŒ–
liff.init({ liffId: "2008718308-nx2rhV48" })
.then(() => {
  return liff.getProfile();
})
.then(profile => {
  const userId = profile.userId;

  btn.addEventListener("click", () => {
    fetch(`${WEB_APP_URL}?lineId=${userId}&station=${station}`)
      .then(res => res.text())
      .then(msg => {
        // é¡¯ç¤º Apps Script å›å‚³è¨Šæ¯
        message.innerText = msg;
      })
      .catch(err => {
        message.innerText = "ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦";
        console.error(err);
      });
  });
})
.catch(err => {
  message.innerText = "";
  btn.style.display = "none";
  btn.disabled = true;
  console.error(err);
});
</script>

</body>
</html>
